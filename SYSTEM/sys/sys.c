#include "sys.h"  
//////////////////////////////////////////////////////////////////////////////////	 
//±¾³ÌÐòÖ»¹©Ñ§Ï°Ê¹ÓÃ£¬Î´¾­×÷ÕßÐí¿É£¬²»µÃÓÃÓÚÆäËüÈÎºÎÓÃÍ¾
//ALIENTEK STM32F407¿ª·¢°å
//ÏµÍ³Ê±ÖÓ³õÊ¼»¯	
//°üÀ¨Ê±ÖÓÉèÖÃ/ÖÐ¶Ï¹ÜÀí/GPIOÉèÖÃµÈ
//ÕýµãÔ­×Ó@ALIENTEK
//¼¼ÊõÂÛÌ³:www.openedv.com
//´´½¨ÈÕÆÚ:2014/5/2
//°æ±¾£ºV1.0
//°æÈ¨ËùÓÐ£¬µÁ°æ±Ø¾¿¡£
//Copyright(C) ¹ãÖÝÊÐÐÇÒíµç×Ó¿Æ¼¼ÓÐÏÞ¹«Ë¾ 2014-2024
//All rights reserved
//********************************************************************************
//ÐÞ¸ÄËµÃ÷
//ÎÞ
//////////////////////////////////////////////////////////////////////////////////  

void GPIO_AF_Set(GPIO_TypeDef* GPIOx,u8 BITx,u8 AFx)
{  
	GPIOx->AFR[BITx>>3]&=~(0X0F<<((BITx&0X07)*4));
	GPIOx->AFR[BITx>>3]|=(u32)AFx<<((BITx&0X07)*4);
}   
//GPIO??????? 
//GPIOx:GPIOA~GPIOI.
//BITx:0X0000~0XFFFF,?????,ÿ???????h??IO,??0?????Px0,??1?????Px1,????????.????0X0101,??????????Px0??Px8.
//MODE:0~3;g????,0,????(?????I????);1,??????;2,???ù???;3,g??????.
//OTYPE:0/1;??????????,0,???????;1,??©???.
//OSPEED:0~3;??????????,0,2Mhz;1,25Mhz;2,50Mhz;3,100Mh. 
//PUPD:0~3:??????????,0,??????????;1,????;2,????;3,????.
//???:??????g?(???????/g??????)??,OTYPE??OSPEED???????!!
void GPIO_Set(GPIO_TypeDef* GPIOx,u32 BITx,u32 MODE,u32 OTYPE,u32 OSPEED,u32 PUPD)
{  
	u32 pinpos=0,pos=0,curpin=0;
	for(pinpos=0;pinpos<16;pinpos++)
	{
		pos=1<<pinpos;	//h???????? 
		curpin=BITx&pos;//???????????????
		if(curpin==pos)	//???????
		{
			GPIOx->MODER&=~(3<<(pinpos*2));	//??????????????
			GPIOx->MODER|=MODE<<(pinpos*2);	//?????µ?g? 
			if((MODE==0X01)||(MODE==0X02))	//????????g?/???ù???g?
			{  
				GPIOx->OSPEEDR&=~(3<<(pinpos*2));	//????????????
				GPIOx->OSPEEDR|=(OSPEED<<(pinpos*2));//?????µ?????  
				GPIOx->OTYPER&=~(1<<pinpos) ;		//????????????
				GPIOx->OTYPER|=OTYPE<<pinpos;		//?????µ????g?
			}  
			GPIOx->PUPDR&=~(3<<(pinpos*2));	//??????????????
			GPIOx->PUPDR|=PUPD<<(pinpos*2);	//?????µ???????
		}
	}
} 
//THUMBÖ¸Áî²»Ö§³Ö»ã±àÄÚÁª
//²ÉÓÃÈçÏÂ·½·¨ÊµÏÖÖ´ÐÐ»ã±àÖ¸ÁîWFI  
__asm void WFI_SET(void)
{
	WFI;		  
}
//¹Ø±ÕËùÓÐÖÐ¶Ï(µ«ÊÇ²»°üÀ¨faultºÍNMIÖÐ¶Ï)
__asm void INTX_DISABLE(void)
{
	CPSID   I
	BX      LR	  
}
//¿ªÆôËùÓÐÖÐ¶Ï
__asm void INTX_ENABLE(void)
{
	CPSIE   I
	BX      LR  
}
//ÉèÖÃÕ»¶¥µØÖ·
//addr:Õ»¶¥µØÖ·
__asm void MSR_MSP(u32 addr) 
{
	MSR MSP, r0 			//set Main Stack value
	BX r14
}
















